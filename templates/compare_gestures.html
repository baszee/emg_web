<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare Gestures - EMG Classifier</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- HEADER WITH HAMBURGER MENU -->
    <header class="header">
        <div class="header-content">
            <a href="{{ url_for('index') }}" class="logo">
                ğŸ¤– EMG Classifier
            </a>
            <button class="hamburger-menu" id="hamburgerMenu" aria-label="Toggle Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- NAVIGATION MENU -->
    <nav class="nav-menu" id="navMenu">
        <ul class="nav-links">
            <li><a href="{{ url_for('index') }}">ğŸ  Dashboard</a></li>
            <li><a href="{{ url_for('predict') }}">ğŸ¯ Predict Gesture</a></li>
            <li><a href="{{ url_for('confidence_tracker') }}">ğŸ“Š Confidence Tracker</a></li>
            <li><a href="{{ url_for('compare_gestures') }}" class="active">ğŸ” Compare Gestures</a></li>
            <li><a href="{{ url_for('batch_predict') }}">ğŸ“ Batch Prediction</a></li>
            <li><a href="{{ url_for('model_info') }}">ğŸ”¬ Model Info</a></li>
        </ul>
    </nav>

    <!-- OVERLAY -->
    <div class="nav-overlay" id="navOverlay"></div>

    <div class="container">
        <div class="hero">
            <h1>ğŸ” Gesture Comparison Tool</h1>
            <p class="hero-subtitle">
                Bandingkan pola EMG antar gestur dan lihat perbedaan sensor activation
            </p>
        </div>

        <!-- Selection -->
        <div class="card">
            <h2>Select Gestures to Compare</h2>
            <div class="grid grid-2">
                <div class="form-group">
                    <label>Gesture 1:</label>
                    <select id="gesture1" class="btn" style="width: 100%; text-align: left;">
                        <option value="0">âœŠ Rock</option>
                        <option value="1">âœŒï¸ Scissors</option>
                        <option value="2">âœ‹ Paper</option>
                        <option value="3">ğŸ‘Œ OK</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Gesture 2:</label>
                    <select id="gesture2" class="btn" style="width: 100%; text-align: left;">
                        <option value="0">âœŠ Rock</option>
                        <option value="1" selected>âœŒï¸ Scissors</option>
                        <option value="2">âœ‹ Paper</option>
                        <option value="3">ğŸ‘Œ OK</option>
                    </select>
                </div>
            </div>
            <button onclick="compareGestures()" class="btn btn-primary">
                ğŸ” Compare
            </button>
        </div>

        <!-- Results -->
        <div id="resultsSection" style="display: none;">
            <!-- Similarity Score -->
            <div class="card">
                <h2>Similarity Analysis</h2>
                <div class="result-box">
                    <div style="font-size: 1.5rem; color: var(--text);">
                        Similarity Score
                    </div>
                    <div class="gesture-result" id="similarityScore">0%</div>
                    <div style="margin-top: 1rem; color: var(--text-light);" id="interpretation"></div>
                </div>
            </div>

            <!-- Heatmaps -->
            <div class="grid grid-3">
                <div class="card">
                    <h3 id="heatmap1Title">Gesture 1</h3>
                    <div id="heatmap1" class="emg-grid"></div>
                </div>
                <div class="card">
                    <h3 id="heatmap2Title">Gesture 2</h3>
                    <div id="heatmap2" class="emg-grid"></div>
                </div>
                <div class="card">
                    <h3>Difference</h3>
                    <div id="heatmapDiff" class="emg-grid"></div>
                </div>
            </div>

            <!-- Insights -->
            <div class="card">
                <h2>Key Insights</h2>
                <div id="insights" style="line-height: 1.8;"></div>
            </div>
        </div>

        <div class="nav-buttons">
            <a href="{{ url_for('index') }}" class="btn btn-secondary">â† Dashboard</a>
            <a href="{{ url_for('predict') }}" class="btn btn-secondary">Try Prediction</a>
        </div>
    </div>

    <script>
        // Hamburger Menu
        const hamburger = document.getElementById('hamburgerMenu');
        const navMenu = document.getElementById('navMenu');
        const navOverlay = document.getElementById('navOverlay');

        function toggleMenu() {
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
            navOverlay.classList.toggle('active');
        }

        hamburger.addEventListener('click', toggleMenu);
        navOverlay.addEventListener('click', toggleMenu);

        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                hamburger.classList.remove('active');
                navMenu.classList.remove('active');
                navOverlay.classList.remove('active');
            });
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && navMenu.classList.contains('active')) {
                toggleMenu();
            }
        });

        // Compare Gestures Functions (EXISTING CODE - NO CHANGES)
        async function compareGestures() {
            const g1 = parseInt(document.getElementById('gesture1').value);
            const g2 = parseInt(document.getElementById('gesture2').value);

            if (g1 === g2) {
                alert('Please select different gestures!');
                return;
            }

            try {
                const response = await fetch('/api/compare', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ gesture1: g1, gesture2: g2 })
                });

                const result = await response.json();
                
                if (result.error) {
                    alert('Error: ' + result.error);
                    return;
                }

                displayResults(result);
            } catch (error) {
                alert('Network error: ' + error);
            }
        }

        function displayResults(result) {
            document.getElementById('resultsSection').style.display = 'block';

            const similarity = result.similarity_score;
            document.getElementById('similarityScore').textContent = similarity.toFixed(1) + '%';
            
            let interpretation = '';
            if (similarity > 80) {
                interpretation = 'ğŸŸ¢ Very similar patterns - Model might confuse these';
            } else if (similarity > 60) {
                interpretation = 'ğŸŸ¡ Moderately similar - Some overlap in activation';
            } else {
                interpretation = 'ğŸ”´ Very different patterns - Easy to distinguish';
            }
            document.getElementById('interpretation').textContent = interpretation;

            document.getElementById('heatmap1Title').textContent = result.gesture1;
            document.getElementById('heatmap2Title').textContent = result.gesture2;

            renderHeatmap('heatmap1', result.heatmap1);
            renderHeatmap('heatmap2', result.heatmap2);
            renderHeatmap('heatmapDiff', result.difference, true);

            generateInsights(result);
        }

        function renderHeatmap(elementId, data, isDiff = false) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';

            const flatData = data.flat();
            const max = Math.max(...flatData);
            const min = Math.min(...flatData);

            flatData.forEach(value => {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                
                const normalized = (value - min) / (max - min + 0.001);
                
                if (isDiff) {
                    cell.style.background = `rgba(185, 28, 28, ${normalized})`;
                    cell.style.color = normalized > 0.6 ? 'white' : '#292524';
                } else {
                    cell.style.background = `rgba(217, 119, 6, ${normalized})`;
                    cell.style.color = normalized > 0.6 ? 'white' : '#292524';
                }
                
                cell.textContent = value.toFixed(1);
                cell.title = `Value: ${value.toFixed(2)}`;
                container.appendChild(cell);
            });
        }

        function generateInsights(result) {
            const insights = document.getElementById('insights');
            
            const diffFlat = result.difference.flat();
            const avgDiff = diffFlat.reduce((a, b) => a + b, 0) / diffFlat.length;
            const maxDiff = Math.max(...diffFlat);
            const maxDiffIndex = diffFlat.indexOf(maxDiff);
            const row = Math.floor(maxDiffIndex / 8);
            const col = maxDiffIndex % 8;

            insights.innerHTML = `
                <p>ğŸ“Š <strong>Average Difference:</strong> ${avgDiff.toFixed(2)} ÂµV</p>
                <p>ğŸ“ˆ <strong>Maximum Difference:</strong> ${maxDiff.toFixed(2)} ÂµV at sensor [${row}, ${col}]</p>
                <p>ğŸ¯ <strong>Most Distinctive Sensor:</strong> Row ${row + 1}, Column ${col + 1}</p>
                <p>ğŸ’¡ <strong>Tip:</strong> ${result.similarity_score > 70 ? 
                    'These gestures have similar patterns. Model uses subtle differences for classification.' : 
                    'Clear distinction makes these gestures easy to classify accurately.'}</p>
            `;
        }
    </script>
</body>
</html>