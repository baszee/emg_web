<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Prediksi - EMG Classifier</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Inline styles untuk warna dinamis heatmap */
        {% for value in input_data_64 %}
            {% set abs_vals = input_data_64 | map('abs') | list %}
            {% set max_val = abs_vals | max %}
            {% set min_val = abs_vals | min %}
            {% set abs_val = value | abs %}
            {% set scaled_opacity = (abs_val - min_val) / (max_val - min_val + 0.001) %}
            
            .cell-{{ loop.index0 }} {
                {% if scaled_opacity > 0.7 %}
                background: rgba(217, 119, 6, {{ scaled_opacity }});
                color: white;
                {% elif scaled_opacity > 0.4 %}
                background: rgba(251, 191, 36, {{ scaled_opacity }});
                color: #292524;
                {% else %}
                background: rgba(254, 243, 199, {{ scaled_opacity + 0.3 }});
                color: #292524;
                {% endif %}
            }
        {% endfor %}
    </style>
</head>
<body>
    <!-- HEADER WITH HAMBURGER MENU -->
    <header class="header">
        <div class="header-content">
            <a href="{{ url_for('index') }}" class="logo">
                ğŸ¤– EMG Classifier
            </a>
            <button class="hamburger-menu" id="hamburgerMenu" aria-label="Toggle Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- NAVIGATION MENU -->
    <nav class="nav-menu" id="navMenu">
        <ul class="nav-links">
            <li><a href="{{ url_for('index') }}">ğŸ  Dashboard</a></li>
            <li><a href="{{ url_for('predict') }}" class="active">ğŸ¯ Predict Gesture</a></li>
            <li><a href="{{ url_for('confidence_tracker') }}">ğŸ“Š Confidence Tracker</a></li>
            <li><a href="{{ url_for('compare_gestures') }}">ğŸ” Compare Gestures</a></li>
            <li><a href="{{ url_for('batch_predict') }}">ğŸ“ Batch Prediction</a></li>
            <li><a href="{{ url_for('model_info') }}">ğŸ”¬ Model Info</a></li>
        </ul>
    </nav>

    <!-- OVERLAY -->
    <div class="nav-overlay" id="navOverlay"></div>

    <div class="container">
        <!-- Header -->
        <div class="hero">
            <div class="hero-content">
                <h1>ğŸ‰ Hasil Prediksi Gestur</h1>
                <p class="hero-subtitle">
                    Model AI telah menganalisis data EMG Anda dan menghasilkan prediksi dengan confidence score.
                </p>
            </div>
        </div>

        <!-- Prediction Result -->
        <section class="prediction-result">
            <h2>ğŸ¯ Gesture Terdeteksi:</h2>
            <div class="predicted-box">
                <span class="gesture-name">{{ gesture }}</span>
            </div>
            
            {% if expected_gesture %}
            <div style="text-align: center; margin-top: 1rem;">
                <p style="color: var(--text-light); font-size: 1rem;">
                    Expected: <strong style="color: var(--primary);">{{ expected_gesture }}</strong>
                    {% if expected_gesture in gesture %}
                    <span style="color: #15803d; font-weight: 700;">âœ“ MATCH!</span>
                    {% else %}
                    <span style="color: #ca8a04; font-weight: 700;">âœ— DIFFERENT</span>
                    {% endif %}
                </p>
            </div>
            {% endif %}
        </section>

        <!-- Confidence Scores -->
        <section class="pipeline-section">
            <h2 class="section-title">ğŸ“Š Confidence Score (Probabilitas)</h2>
            <p style="color: var(--text-light); margin-bottom: 1.5rem;">
                Model memberikan skor kepercayaan untuk setiap kelas gestur. Semakin tinggi persentase, 
                semakin yakin model dengan prediksinya.
            </p>
            
            <div class="probability-list">
                {% for class_id, class_name in gesture_map.items() %}
                <div class="prob-item">
                    <span class="prob-label">{{ class_name }}:</span>
                    
                    {% set confidence = probabilities[class_id] * 100 %}
                    <span class="prob-value">{{ confidence | round(2) }}%</span>
                    
                    <div class="prob-bar-container">
                        <div class="prob-bar" style="width: {{ confidence | round(0) }}%;"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Input Visualization -->
        <section class="pipeline-section">
            <h2 class="section-title">ğŸ¨ Visualisasi Input Sinyal (8Ã—8 Grid)</h2>
            <p style="color: var(--text-light); margin-bottom: 1rem;">
                Heatmap di bawah menampilkan 64 nilai EMG Anda dalam format grid 8Ã—8. 
                Warna yang lebih gelap menunjukkan aktivitas otot yang lebih kuat.
            </p>
            
            <div class="emg-grid-container">
                <div class="emg-grid">
                    {% for value in input_data_64 %}
                        <div class="grid-cell cell-{{ loop.index0 }}" 
                             title="Sensor Value: {{ value | round(2) }}">
                            {{ value | round(1) }}
                        </div>
                    {% endfor %}
                </div>
            </div>
            
            <p style="color: var(--text-light); text-align: center; margin-top: 1rem; font-size: 0.9rem;">
                ğŸ’¡ Hover pada setiap cell untuk melihat nilai eksak sensor
            </p>
        </section>

        <!-- Navigation -->
        <nav class="navigation-bottom">
            <a href="{{ url_for('predict') }}" class="primary">
                ğŸ”„ Coba Prediksi Lagi
            </a>
            <a href="{{ url_for('index') }}" class="secondary-button">
                ğŸ  Kembali ke Dashboard
            </a>
            <a href="{{ url_for('model_info') }}" class="secondary-button">
                ğŸ”¬ Lihat Info Model
            </a>
        </nav>
    </div>

    <script>
        // Hamburger Menu
        const hamburger = document.getElementById('hamburgerMenu');
        const navMenu = document.getElementById('navMenu');
        const navOverlay = document.getElementById('navOverlay');

        function toggleMenu() {
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
            navOverlay.classList.toggle('active');
        }

        hamburger.addEventListener('click', toggleMenu);
        navOverlay.addEventListener('click', toggleMenu);

        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                hamburger.classList.remove('active');
                navMenu.classList.remove('active');
                navOverlay.classList.remove('active');
            });
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && navMenu.classList.contains('active')) {
                toggleMenu();
            }
        });
    </script>
</body>
</html>